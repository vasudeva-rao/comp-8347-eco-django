{% extends 'base.html' %}
{% block title %}User Uploads Gallery{% endblock %}
{% block content %}
<h2>User Uploads Gallery</h2>
<div class="row">
    {% for upload in uploads %}
    <div class="col-md-4 mb-4">
        <div class="card h-100">
            <div class="card-body">
                <h5 class="card-title">{{ upload.title }}</h5>
                <p class="card-text"><small>Uploaded by: {{ upload.user.username }}</small></p>
                {% if upload.file.url|lower|slice:'-4:' == '.jpg' or upload.file.url|lower|slice:'-5:' == '.jpeg' or upload.file.url|lower|slice:'-4:' == '.png' or upload.file.url|lower|slice:'-4:' == '.gif' %}
                    <img src="{{ upload.file.url }}" alt="Image" class="img-fluid mb-2 preview-img" style="max-height:150px; cursor:pointer;" data-bs-toggle="modal" data-bs-target="#imageModal" data-img-url="{{ upload.file.url }}">
                {% else %}
                    <a href="{{ upload.file.url }}" target="_blank">Download/View File</a>
                {% endif %}
                <p class="card-text"><small>Uploaded on: {{ upload.upload_date|date:"M d, Y H:i" }}</small></p>
            </div>
        </div>
    </div>
    {% empty %}
    <p>No uploads yet.</p>
    {% endfor %}
</div>
<!-- Image Preview Modal -->
<div class="modal fade" id="imageModal" tabindex="-1" aria-labelledby="imageModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="imageModalLabel">Image Preview</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body text-center">
        <img src="" id="modalImage" class="img-fluid" alt="Preview">
      </div>
    </div>
  </div>
</div>
<script>
document.addEventListener('DOMContentLoaded', function() {
    var imageModal = document.getElementById('imageModal');
    var modalImage = document.getElementById('modalImage');
    document.querySelectorAll('.preview-img').forEach(function(img) {
        img.addEventListener('click', function() {
            modalImage.src = this.getAttribute('data-img-url');
        });
    });
    imageModal.addEventListener('hidden.bs.modal', function () {
        modalImage.src = '';
    });
});
</script>
{% endblock %} 